<!DOCTYPE html>
<html style="font-size: 16px;" lang="en"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Week 2: 2D Design and Cutting">
    <meta name="description" content="">
    <title>Page 7</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Page-7.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 5.0.7, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700,700i|Roboto+Slab:100,200,300,400,500,600,700,800,900">
    
   <script>hljs.initHighlightingOnLoad();</script>   
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Page 7">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body u-xl-mode" data-lang="en"><header class="u-clearfix u-header u-palette-1-light-3 u-header" id="sec-d2da"><div class="u-clearfix u-sheet u-sheet-1">
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px; font-weight: 700; text-transform: uppercase;">
            <a class="u-button-style u-custom-active-border-color u-custom-active-color u-custom-border u-custom-border-color u-custom-borders u-custom-hover-border-color u-custom-hover-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg class="u-svg-link" viewBox="0 0 24 24"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-spacing-30 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="../Home.html" style="padding: 10px 0px;">Home</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="../About.html" style="padding: 10px 0px;">About</a>
</li><li class="u-nav-item"><a class="u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-base u-border-no-left u-border-no-right u-border-no-top u-button-style u-nav-link u-text-active-palette-1-base u-text-grey-90 u-text-hover-grey-90" href="../Contact.html" style="padding: 10px 0px;">Contact</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Home.html">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="About.html">About</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Contact.html">Contact</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
        <h3 class="u-custom-font u-font-roboto-slab u-text u-text-default u-text-1">PS70: Intro to Digital Fabrication</h3>
      </div></header>
    <section class="u-clearfix u-section-1" id="carousel_99a0">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h1 class="u-custom-font u-font-roboto-condensed u-text u-text-palette-1-light-2 u-text-1">Week 7: Electronic output devices</h1>
        <p class="u-align-left u-custom-font u-font-roboto-slab u-text u-text-2"><b></b><b style="">Output device</b>
          <br>
          <br>For this week’s project my goal, was to continue developing the sensor system for my final project. I wanted to create a water sensor that would turn off my pump if water levels were too low and relate the speed to the water level if the water level was above this minimum value. Since I more or less did this with the capacitive sensors last week, I wanted to make my system more complex and add a TFT screen display as one of my outputs so the user could monitor the status of their pump. Additionally I switched out my capacitive sensors for the “High Sensitivity Water sensor” available in the lab.<br>
          <br><u>Water level Sensor</u>
          <br>
          <br>This water sensor works in the form of a variable resistor, where the resistance varies based on resistance based on the water of level it is exposed to. The code I began with was very similar to the code I used last week. I started out with just the one output of the motor to keep things simple.<br>
          <br>I realized very quickly that the water level sensor was much more sensitive than I had anticipated. This makes sense in hindsight given that I believe this sensor is normally used for soil moisture data. As such I will probably have to reevaluate whether it is appropriate to use for my final project.<br>
          <br>Nevertheless, the code worked well but I realized that the sensor values were not water level values. I performed a similar extrapolation to last week and got the following curve:<br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br><u>Using the TFT display</u>
          <br>
          <br>To make my system more complex, and get to experiment with a new sensor, I decided to go with the TFT screen sensor since this could easily be incorporate into my pre-existing water sensor and pump system. I decided I wanted to display a warning level when my water fell below a minimum value, and to otherwise just display the water value.<br>
          <br>I started off with the sample example code for TFT graphics but found this had way more information than I needed since I was only looking to have text as an output and no graphics. I decided to look online for simpler resources but the code I ended up using was an outdated TFT code that was not recognized by Arduino so this ended up being a mistake. In the end Kassia saved the day and walked through the more complicated TFT code so I could understand which parts were relevant to my code.<br>
          <br>Once the code ran I realized that the sensor values were printing on top of each other. To fix this I simply added a delay after the code.<br>
          <br><u>Removing delays</u>
          <br>
          <br>Again, I followed my work from that week and used the millis structure to remove any delays. While the code ran at first, I experience the same error from before where the previous data would overlay over each other. In addition, there also seemed to be no delay in printing the sensor values this time. I realized that my error was coming from the fact that I was not updating the millis after each value. Therefore, it was running through the if loop and not resetting but instead showing multiple values all at once (if I understand correctly).<br>
          <br><u>Using C++ structures</u>I couldn’t figure out how to implement the C++ structure with my given code. There were too many variables and when I tried to separate the pump into its own class it wasn’t working. My goal therefore for the rest of this week is to figure this out!<br>
          <br><u>Using the Oscilloscope</u>
          <br>
          <br>I was slightly confused how to use the oscilloscope at first, however, once Ibrahim walked me through it and showed me how to read the voltage and period values it made a lot more sense. I started off by measured my sensor, and given how sensitive it was it was really difficult to get a reading on the voltage used because it would fluctuate so much. Below is a video of the reading I would get:<br>
          <br>When I switched to the pump measurements, I found that there was way less fluctuation. The values I got are shown below but I interpreted this roughly as&nbsp;&nbsp;a Vmax of 5V and a period of 2ms.<br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <span style="text-decoration: underline !important;"> Code</span>
          <br>
          <br>Here is my code based on the previous discussion: <br>
          <br>&lt;pre&gt;&lt;code&gt; <br>
          <br>#include &lt;Adafruit_GFX.h&gt;    // Core graphics library <br>#include &lt;Adafruit_ST7735.h&gt; // Hardware-specific library for ST7735 <br>#include &lt;Adafruit_ST7789.h&gt; // Hardware-specific library for ST7789 <br>
          <br>//#include &lt;TFT.h&gt;  // Arduino LCD library <br>#include &lt;SPI.h&gt; <br>
          <br>
          <br>
          <br>// create an instance of the library <br>#define TFT_CS        10 <br>#define TFT_RST        9 <br>#define TFT_DC         8 <br>//TFT TFTscreen = TFT(TFT_CS, TFT_DC, TFT_RST); <br>Adafruit_ST7789 tft = Adafruit_ST7789(TFT_CS, TFT_DC, TFT_RST); <br>
          <br>// char array to print to the screen <br>char sensorPrintout[4]; <br>
          <br>
          <br>
          <br>// constants won't change. They're used here to set pin numbers: <br>const int A1A = 3;  // define pin 3 for A-1A (PWM Speed) <br>const int A1B = 2; <br>// Sensor pins <br>const int sensorPower = 7; <br>const int sensorPin = A5; <br>
          <br>
          <br>// Value for storing water level <br>int sensorState = 0; <br>int val = 0; <br>float p = 3.1415926; <br>
          <br>
          <br>unsigned long currentMillis; <br>unsigned long previousMillis=0; <br>unsigned long interval = 1000 ; <br>
          <br>
          <br>//This is a function used to get the reading <br>int readSensor(unsigned long currentMillis, unsigned long previousMillis) { <br> digitalWrite(sensorPower, HIGH);  // Turn the sensor ON <br> (currentMillis - previousMillis &gt;= interval);          // wait 1000 milliseconds&amp;&amp; (currentMillis - previousMillis1 &gt;= interval) <br> val = analogRead(sensorPin);    // Read the analog value form sensor <br> digitalWrite(sensorPower, LOW);   // Turn the sensor OFF <br> return val;             // send current reading <br>} <br>
          <br>
          <br>void setup() { <br> Serial.begin(9600); <br> pinMode(A1A, OUTPUT);     // specify these pins as outputs <br> pinMode(A1B,OUTPUT); <br> digitalWrite(A1B, LOW); <br> analogWrite(A1A, 0);   // start with the motors off <br> pinMode(sensorPin, INPUT); <br>
          <br>// Set D7 as an OUTPUT <br> pinMode(sensorPower, OUTPUT); <br> // Set to LOW so no power flows through the sensor <br> digitalWrite(sensorPower, LOW); <br>
          <br>Serial.println(val); <br> tft.init(135, 240);           // Init ST7789 240x135 <br>tft.fillScreen(ST77XX_BLACK); <br>
          <br>} <br>
          <br>//Screen <br>// Put this line at the beginning of every sketch that uses the GLCD: <br> //TFTscreen.begin(); <br>
          <br>
          <br>
          <br>void testdrawtext(char *text, uint16_t color) { <br> tft.setCursor(0, 0); <br> tft.setTextColor(color); <br> tft.setTextWrap(true); <br> tft.print(text); <br>} <br>
          <br>
          <br>//} <br>
          <br>
          <br>//try running with delays tomorrow <br>//remove delays <br>// figure out error with measurement <br>// measure on oscilloscope <span style="font-weight: 700; text-decoration: underline !important;">
            <br>
            <br>// <br>
            <br>void loop(){ <br>
            <br> currentMillis = millis(); <br>
            <br> //get the reading from the function below and print it <br> int level = readSensor(currentMillis,previousMillis); <br>
            <br> Serial.print("Water level: "); <br> Serial.println(level); <br>
            <br>
            <br>
            <br>
            <br> if ((level &lt; 100) &amp;&amp; (currentMillis - previousMillis &gt;= interval)) <br> { <br>
            <br> analogWrite(A1A, 0);   // Speed to match photosensor <br>
            <br> testdrawtext("Warning: Low water level ", ST77XX_WHITE); <br> (currentMillis - previousMillis &gt;= interval); <br> previousMillis = currentMillis; <br>//    tft.println("WARNING: LOW WATER LEVEL"); <br> // set the font color <br> //    tft.setTextColor(ST7735_RED); <br>
            <br> }else if( (level &gt; 100) &amp;&amp; (currentMillis - previousMillis &gt;= interval)){ <br> analogWrite(A1A, level);   // Speed to match photosensor <br> // Read the value of the sensor on A5 <br> // Read the value of the sensor on A5 <br> String sensorVal = String((level - 52.5)/69.1); <br>
            <br> const char* ah = sensorVal.c_str(); <br>
            <br>
            <br> Serial.println(ah); <br> tft.fillScreen(ST77XX_BLACK); <br>
            <br> testdrawtext(ah, ST77XX_WHITE); <br> (currentMillis - previousMillis &gt;= interval); <br> previousMillis = currentMillis; <br>
            <br>
            <br>
            <br>} <br>} <br>
            <br>//} <br>
            <br>&lt;/code&gt;&lt;/pre&gt;&nbsp;<br>
            <br>
            <span style="font-weight: 700;"> Final Product</span>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <span style="font-weight: 700;">&nbsp;Challenges&nbsp;</span>
          </span>
          <br>
          <br>It was really challenging dealing with so many input and output variables this week as I am still getting used to Arduino code. However, I got it to work in the end and got more valuable troubleshooting skills. In the future I would like to investigate having a more complex categorization system such that it reads “low water level”, “medium water level” and “high water level” depending on a pre-determined range of values. I am also excited to incorporate Wifi or Bluetooth in the coming weeks so that I can send this data directly to my phone. <br>
          <br>&lt;u&gt; CAD drawing &lt;/u&gt; <br>For the milling and casting project next week I decided to take a break with my final project plans and design something cute for my room. I went with a panda (that looks more like a pig but oh well). <br>
          <br>Here are my original CAD drawings:&nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I then&nbsp; followed [this](https://www.youtube.com/watch?v=vKZx9eHEL6o) tutorial which&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;explained how to create a mold out of this. I&nbsp; tried 2.5D in Fusion 360 as well but all the new&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;features confused me so I thought I would keep it simple for my first test run. The tutorial was&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;straightforward. I had some weird issues arise with cutting the component in my block so that it&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;would produce an indent shape but I think it was reading the component weirdly. This was&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ultimately resolve by moving my panda component back to a separate body, although I’m not too&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sure why that worked. <br>
          <br>
          <br>
          <br>After talking to Kassia she told me it may be hard to mill circular shapes (i.e. the legs and arms) at an angle as shown above so I tried to make them more perpendicular to the main body. Hopefully this version works a little better (saved as an STL). <br>
          <br>&lt;iframe src="https://college418.autodesk360.com/shares/public/SH9285eQTcf875d3c53903d799f79aad9cf7?mode=embed" width="640" height="480" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"  frameborder="0"&gt;&lt;/iframe&gt; <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
        </p>
        <img class="u-image u-image-default u-image-1" src="images/calibration.png" alt="" data-image-width="1653" data-image-height="993">
        <div class="u-uploaded-video u-video u-video-contain u-video-1">
          <div class="embed-responsive">
            <video class="embed-responsive-item">
              <source src="files/sensor.mp4" type="video/mp4">
              <p>Your browser does not support HTML5 video.</p>
            </video>
            <button class="u-video-poster"></button>
          </div>
        </div>
        <div class="u-uploaded-video u-video u-video-contain u-video-2">
          <div class="embed-responsive">
            <video class="embed-responsive-item">
              <source src="files/pump.mp4" type="video/mp4">
              <p>Your browser does not support HTML5 video.</p>
            </video>
            <button class="u-video-poster"></button>
          </div>
        </div>
        <div class="u-uploaded-video u-video u-video-contain u-video-3">
          <div class="embed-responsive">
            <video class="embed-responsive-item">
              <source src="files/system.mp4" type="video/mp4">
              <p>Your browser does not support HTML5 video.</p>
            </video>
            <button class="u-video-poster"></button>
          </div>
        </div>
        <img class="u-image u-image-contain u-image-default u-image-2" src="images/panda.png" alt="" data-image-width="256" data-image-height="282">
      </div>
    </section>
    
    
    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-3712"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">Layla Seaver - Environmental Engineering Harvard College '24</p>
      </div></footer>
    <section class="u-backlink u-clearfix u-grey-80">
      <a class="u-link" href="https://nicepage.com/templates" target="_blank">
        <span>Template</span>
      </a>
      <p class="u-text">
        <span>created with</span>
      </p>
      <a class="u-link" href="https://nicepage.com/html-website-builder" target="_blank">
        <span>HTML Website Builder</span>
      </a>. 
    </section>
  
</body></html>